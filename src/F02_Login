def readCSV(path:str):
    data = []
    with open(path,'r') as file:
        for line in file:
            elmt = ''
            row = []
            for char in line:
                if char == ";":
                    row.append(elmt)
                    elmt = ''
                else:
                    elmt = elmt + char
            data.append(row)
    return data
    
users = readCSV('data/user.csv')

def login(users, logged_in_user, username, password):
    """Menangani proses login dan mengembalikan pesan hasil login."""
    # Memeriksa apakah pengguna sudah logged in
    if logged_in_user is not None:
        return f"Login gagal! Anda telah login dengan username {logged_in_user}, silahkan lakukan 'LOGOUT' sebelum melakukan login kembali.", logged_in_user

    # Memeriksa apakah username terdaftar
    user_info = users.get(username)
    if user_info is None:
        return "Username tidak terdaftar!", logged_in_user

    # Memeriksa apakah password cocok
    if user_info['password'] != password:
        return "Password salah!", logged_in_user

    # Set user yang login saat ini
    logged_in_user = username
    role = user_info['role']
    return f"Selamat datang, {role} {username}! Masukkan command 'help' untuk daftar command yang dapat kamu panggil.", logged_in_user

def main():
    # Path ke file CSV
    csv_file = 'data/user.csv'
    
    # Membaca data pengguna dari file CSV
    users = readCSV(csv_file)
    
    # Variabel untuk menyimpan pengguna yang saat ini logged in
    logged_in_user = None

    username = input("Username:")
    password = input("Password:")
    
    # Memanggil fungsi login dengan input dari pengguna
    result, logged_in_user = login(users, logged_in_user, username, password)
    
    # Mencetak pesan hasil login
    print(result)

if __name__ == '__main__':
    main()
